# ABI

ABI (Application Binary Interface) はプログラムがコンパイルされバイナリとして動作する際、 CPU やメモリ、システムコールをどのように扱ってやり取りするかを規定する。
以下のような項目を規定する。

1. 関数呼び出し規約（Calling Convention）
    - 関数の引数の渡し方: 引数がレジスタを使って渡されるのか、スタックを使って渡されるのか
    - 戻り値の扱い: 関数の戻り値がどのレジスタを通じて返されるか
    - スタックの管理: スタックフレームをどのように構築し、誰がクリーンアップするのか（呼び出し元か、呼び出し先か）
1. データ型とデータ配置
    - 基本データ型のサイズと表現方法: 例えば、intやfloatなどのデータ型のサイズやエンディアン
    - 構造体やクラスのメモリレイアウト: データフィールドの配置やパディングのルール
    - アライメント: データがメモリ上でどのように整列するか
1. システムコールインターフェース
    - オペレーティングシステムとやり取りする方法を定義する
    - 例えば、Linuxでは特定のレジスタを通してシステムコール番号や引数を渡します

# 　ABI の種類

一般的にCPUアーキテクチャやOSが異なれば、対応するABIも異なる。

| **ABIの種類**         | **対応CPUアーキテクチャ**        | **対応OS**               | **特徴**                                                                                       |
|-----------------------|----------------------------------|-------------------------|-----------------------------------------------------------------------------------------------|
| **System V ABI**      | x86, x86-64, ARM, RISC-V       | Linux, Solaris, FreeBSD | - Unix系標準のABI。<br>- ELF形式バイナリを使用。<br>- 呼び出し規約が明確に定義されている。       |
| **Microsoft x86 ABI** | x86                            | Windows                | - Windows専用のABI。<br>- スタックで引数を渡す規約が主流。                                     |
| **Microsoft x64 ABI** | x86-64                         | Windows                | - Windowsの64ビット専用ABI。<br>- 引数はレジスタ（RCX, RDX, R8, R9）で渡される。              |
| **AAPCS (ARM ABI)**   | ARM (32ビット)                 | Linux, FreeBSD         | - ARM専用のABI。<br>- 引数はR0～R3レジスタ、戻り値はR0で返される。                            |
| **AArch64 ABI**       | ARM64 (64ビット)               | Linux, macOS, iOS      | - ARM64専用のABI。<br>- 引数はX0～X7レジスタで渡される。<br>- Apple Siliconでは独自拡張あり。 |
| **RISC-V ABI**        | RISC-V                         | Linux, FreeBSD         | - RISC-V専用のABI。<br>- 引数はx10～x17レジスタを使用。                                        |
| **PowerPC ELF ABI**   | PowerPC                        | Linux, FreeBSD         | - PowerPC専用のABI。<br>- レジスタとスタックを組み合わせた効率的な規約。                       |
| **Mach-O ABI**        | x86-64, ARM64 (Apple Silicon)  | macOS, iOS             | - Apple独自のABI。<br>- Mach-O形式のバイナリと`dyld`動的リンカを使用。                        |
| **EABI**              | ARM, MIPS                      | Linux (組み込み向け)   | - 組み込み向けの軽量ABI。<br>- 標準ライブラリを最小限にした設計。                              |
