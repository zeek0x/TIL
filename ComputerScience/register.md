# レジスタ

CPU に内蔵された記憶領域であり、汎用レジスタと特殊レジスタがある。

- 汎用レジスタ：一般の演算に使用 
- 特殊レジスタ：CPUの設定やタイマ、割り込みなどを制御するのに使用

待ち時間なく読み書き可能なので、2 GHz で動作する CPU であれば 0.5 ns （ナノ秒）で読み書きできる。

## x86-64 アーキテクチャ

- x86-64 の汎用レジスタは16個：RAX, RBX, RDX, RBP, RSI, RDI, RSP, R8 - R15
- x86-64 アーキテクチャの汎用レジスタは 8 B（バイト）単位でデータをやり取りする
- 8B より小さな単位でデータを扱いたい場合、レジスタの一部を小さなレジスタとしてアクセスが可能である

### 汎用レジスタと下位バイトの別名

RAX Type: RAX, RBX, RCX, RDX

```plaintext
+--------+--------+--------+--------+--------+--------+--------+--------+
|                                 RAX(64)                               |
+--------+--------+--------+--------+--------+--------+--------+--------+
                                    |               EAX(32)             |
                                    +--------+--------+--------+--------+
                                                      |       AX(16)    |
                                                      +--------+--------+
                                                      |  AH(8) |  AL(8) |
                                                      +--------+--------+
```

RBP Type: RBP, RSP, RSI, RDI

```plaintext
+--------+--------+--------+--------+--------+--------+--------+--------+
|                                 RBP(64)                               |
+--------+--------+--------+--------+--------+--------+--------+--------+
                                    |               EBP(32)             |
                                    +--------+--------+--------+--------+
                                                      |       BP(16)    |
                                                      +--------+--------+
                                                               | BPL(8) |
                                                               +--------+
```

R8 Type: R8 - R15

```
+--------+--------+--------+--------+--------+--------+--------+--------+
|                                  R8(64)                               |
+--------+--------+--------+--------+--------+--------+--------+--------+
                                    |               R8D(32)             |
                                    +--------+--------+--------+--------+
                                                      |      R8W(16)    |
                                                      +--------+--------+
                                                               | R8B(8) |
                                                               +--------+
```

#### 各汎用レジスタの解説

| レジスタ名 | 名称 | 説明 |
| --- | --- | --- |
| RBP | Base Pointer | RBP はスタックフレームの基準点を示すレジスタスで、タックフレームは、関数が実行される間、ローカル変数や関数の引数などを保存する |
| RSP | Stack Pointer | RSP は現在のスタックのトップを示すレジスタで、スタックに新しいデータを追加すると、rspの値が減少し、逆にデータを取り出すと増加する |

### 特殊レジスタ

多くの種類があるが、代表的なものには以下がある。

| レジスタ名 | 名称 | 説明 |
| --- | --- | --- |
| RIP | Instruction Pointer | 命令ポインタレジスタ。CPUが次に実行する命令のメモリアドレスを保持する|
| RFLAGS | Flags Register | フラグレジスタ。命令の実行結果に応じて変化する各種フラグを保持する例えば、演算結果がゼロの場合にセットされるゼロフラグ（ZF）や、キャリーが発生した際にセットされるキャリーフラグ（CF）などがある |
| CR0 | Control Register 0 | 制御レジスタ0。CPUの動作モードや状態を制御するための設定を保持しする。例えば、プロテクトモードの有効化や、キャッシュの制御などが含まれる |

