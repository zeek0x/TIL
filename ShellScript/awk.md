# awk コマンド

## awkによる検索と計算

```console
$ seq 5 | awk '/[24]/'
2
4
```

正規表現を扱える。

```console
$ seq 5 | awk '$1%2==0'
2
4
```

検索対象の列に対しての計算結果を評価することができる。`awk`コマンドでは読み込んだ行に対して区切り文字（デフォルトではスペース、`-F`オプションで指定可能）によって列として認識される。`$1`は「読み込んだ行の１列目の文字列」を意味している。2列目以降は、`$2`, `$3`, ...というように扱うことができる。

```console
$ seq 5 | awk '$1%2==0{printf("%s 偶数\n",$1)}'
2 偶数
4 偶数
```

検索にマッチした行に処理を加えることができる。`printf`は引数にテンプレートと埋め込む値を引数にとり、フォーマットされた文字列を出力する。また、引数を表示するだけの`print`を使って`print $1,"偶数"`のように書いても良い。

```console
$ seq 5 | awk '$1%2==0{print $1, "偶数"}$1%2{print $1,"奇数"}'
1 奇数
2 偶数
3 奇数
4 偶数
5 奇数
```

非ゼロの値は真と評価するので２つ目のルールは表記を省略している。

```console
$ seq 5 | awk 'BEGIN{a=0}%1%2==0{print %1,"偶数"}%1%2{print %1,"奇数"}{a+=$1}END{print "合計", a}'
seq 5 | awk 'BEGIN{a=0}$1%2==0{print $1,"偶数"}$1%2{print $1,"奇数"}{a+=$1}END{print "合計", a}'
1 奇数
2 偶数
3 奇数
4 偶数
5 奇数
合計 15
```

`BEGIN`、`END`はそれぞれBEGINパターン、ENDパターンと呼ばれ、それぞれ「`awk`が１行目の処理を始める前」、「`awk`が最終行の処理を終えた後」という状況にマッチする。`awk`の変数を宣言せずとも`0`で初期化されるので、この例の`BEGIN{a=0}`の部分は省略可能である。

